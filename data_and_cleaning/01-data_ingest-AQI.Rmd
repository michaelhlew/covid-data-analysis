---
title: "01-data_ingest"
date: "`r Sys.Date()`"
---

This file will ingest and clean all DC Air Quality Index (AQI) for 2020-2022. The raw data was downloaded from https://www.epa.gov/outdoor-air-quality-data/air-quality-index-daily-values-report. The following selections were made:

- We selected the option "all pollutants"
- We chose the following years: 2020, 2021, 2022
- Chose geographic area DC (District of Columbia)

There were three raw data file exports (one for each year). They can be accessed in the "raw_data" folder.

```{r, include=FALSE}
library(tidyverse)
library(lubridate)
library(janitor)
```

```{r}
# read in raw data
AQI_2022 <- read_csv("raw_data/raw_2022_airquality_DC.csv", na = ".")
AQI_2021 <- read_csv("raw_data/raw_2021_airquality_DC.csv", na = ".")
AQI_2020 <- read_csv("raw_data/raw_2020_airquality_DC.csv", na = ".")

```

It appears that one variable "PM10" is all N/A or was not collected for 2022. In order to bind the data frames and keep consistency we drop "PM10" from 2021 and 2020 data frames. 

```{r}
AQI_2020 <- AQI_2020 %>% select(-PM10) 
AQI_2021 <- AQI_2021 %>% select(-PM10) 

# quick check for consistency
names(AQI_2020) == names(AQI_2021) 
names(AQI_2021) == names(AQI_2022)
```

Binding together the data frames
```{r}
bind_rows(AQI_2020, AQI_2021, AQI_2022) -> combined_AQI
```

Cleaning up the names
```{r}
janitor::clean_names(dat = combined_AQI) -> combined_AQI
```

Fixing the date and creating factors
```{r}
combined_AQI <- combined_AQI %>%
  mutate(
    date = mdy(date),
    main_pollutant = as_factor(main_pollutant),
    site_name_of_overall_aqi = as_factor(site_name_of_overall_aqi),
    site_id_of_overall_aqi = as_factor(site_id_of_overall_aqi),
    source_of_overall_aqi = as_factor(source_of_overall_aqi)
  )
```

Taking a look 
```{r}
head(combined_AQI)
```

Export to CSV
```{r}
write_csv(combined_AQI, file = "./combined_AQI_clean.csv")
```





